<Window x:Class="CulvertEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
        xmlns:dxr="http://schemas.devexpress.com/winfx/2008/xaml/ribbon"
        xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars" 
        xmlns:helix="http://helix-toolkit.org/wpf"
        Title="Culvert Box - Design Tool" Height="900" Width="1400"
        Background="White"
        Loaded="Window_Loaded" WindowStartupLocation="CenterScreen"
        dx:ThemeManager.ThemeName="Win11Light">

    <Window.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="5,1"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="12"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#0078D4"/>
                    <Setter Property="BorderThickness" Value="1.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <Style TargetType="Separator">
            <Setter Property="Background" Value="#E0E0E0"/>
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="0,12"/>
        </Style>

        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="#333"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1084E8"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#005A9E"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- ========== RIBBON CONTROL ========== -->
        <dxr:RibbonControl Grid.Row="0" 
                   RibbonHeaderVisibility="Collapsed" 
                    VerticalAlignment="Center"
                    RibbonStyle="Office2019">

            <dxr:RibbonDefaultPageCategory>
                <dxr:RibbonPage Caption="TRANG CHỦ">

                    <!-- ========== GROUP: FILE ========== -->
                    <dxr:RibbonPageGroup Caption="File" 
                                 ShowCaptionButton="False">
                        <dxb:BarButtonItem 
                            Content="Mới" 
                            LargeGlyph="{dx:DXImage 'SvgImages/Actions/New.svg'}"
                            ItemClick="NewProject_Click"
                            Hint="Tạo dự án mới (Ctrl+N)"
                            RibbonStyle="Large"
                            KeyGesture="Ctrl+N"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Mở"
                            LargeGlyph="{dx:DXImage 'SvgImages/Actions/Open.svg'}"
                            ItemClick="OpenProject_Click"
                            Hint="Mở dự án (Ctrl+O)"
                            RibbonStyle="Large"
                            KeyGesture="Ctrl+O"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Lưu" 
                            Glyph="{dx:DXImage 'SvgImages/DiagramIcons/save.svg'}"
                            ItemClick="SaveProject_Click"
                            Hint="Lưu dự án (Ctrl+S)"
                            RibbonStyle="SmallWithText"
                            KeyGesture="Ctrl+S"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Lưu Mới" 
                            Glyph="{dx:DXImage 'SvgImages/DiagramIcons/save as.svg'}"
                            ItemClick="SaveAsProject_Click"
                            Hint="Lưu dự án với tên mới"
                            RibbonStyle="SmallWithText"
                            Margin="3"/>
                    </dxr:RibbonPageGroup>

                    <!-- ========== GROUP: EXPORT ========== -->
                    <dxr:RibbonPageGroup Caption="Xuất" 
                                 ShowCaptionButton="False">
                        <dxb:BarButtonItem 
                            Content="Xuất PDF" 
                            LargeGlyph="{dx:DXImage 'SvgImages/XAF/Action_Export_ToPDF.svg'}"
                            ItemClick="ExportPDF_Click"
                            Hint="Xuất bản vẽ ra PDF"
                            RibbonStyle="Large"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Xuất DXF" 
                            LargeGlyph="{dx:DXImage 'SvgImages/Export/ExportFile.svg'}"
                            ItemClick="ExportDXF_Click"
                            Hint="Xuất bản vẽ ra DXF (AutoCAD)"
                            RibbonStyle="Large"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="In" 
                            LargeGlyph="{dx:DXImage 'SvgImages/Scheduling/Print.svg'}"
                            ItemClick="Print_Click"
                            Hint="In bản vẽ (Ctrl+P)"
                            RibbonStyle="Large"
                            KeyGesture="Ctrl+P"
                            Margin="3"/>
                    </dxr:RibbonPageGroup>

                    <!-- ========== GROUP: VIEW ========== -->
                    <dxr:RibbonPageGroup Caption="Hiển thị" 
                                 ShowCaptionButton="False">
                        <dxb:BarCheckItem 
                            Content="Kích thước" 
                            Glyph="{dx:DXImage 'SvgImages/Dashboards/ReorderTabs.svg'}"
                            IsChecked="True"
                            CheckedChanged="ToggleDimensions_CheckedChanged"
                            Hint="Hiển thị kích thước"
                            RibbonStyle="SmallWithText"
                            Margin="3"/>

                        <dxb:BarCheckItem 
                            Content="Điểm" 
                            Glyph="{dx:DXImage 'SvgImages/DiagramIcons/CircularLayout.svg'}"
                            IsChecked="True"
                            CheckedChanged="TogglePoints_CheckedChanged"
                            Hint="Hiển thị các điểm đặc trưng"
                            RibbonStyle="SmallWithText"
                            Margin="3"/>

                        <dxb:BarCheckItem 
                            Content="Lưới" 
                            Glyph="{dx:DXImage 'SvgImages/Spreadsheet/ChartGridlines.svg'}"
                            IsChecked="False"
                            CheckedChanged="ToggleGrid_CheckedChanged"
                            Hint="Hiển thị lưới"
                            RibbonStyle="SmallWithText"
                            Margin="3"/>
                    </dxr:RibbonPageGroup>

                    <!-- ========== GROUP: TOOLS ========== -->
                    <dxr:RibbonPageGroup Caption="Công cụ" 
                                 ShowCaptionButton="False">
                        <dxb:BarButtonItem 
                            Content="Tính toán" 
                            LargeGlyph="{dx:DXImage 'SvgImages/Icon Builder/Business_Calculator.svg'}"
                            ItemClick="Calculate_Click"
                            Hint="Tính toán thủy lực và kết cấu"
                            RibbonStyle="Large"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Kiểm tra" 
                            LargeGlyph="{dx:DXImage 'SvgImages/Content/CheckBox.svg'}"
                            ItemClick="Validate_Click"
                            Hint="Kiểm tra tính hợp lệ của thiết kế"
                            RibbonStyle="Large"
                            Margin="3"/>
                    </dxr:RibbonPageGroup>

                    <!-- ========== GROUP: HELP ========== -->
                    <dxr:RibbonPageGroup Caption="Trợ giúp" 
                                 ShowCaptionButton="False">
                        <dxb:BarButtonItem 
                            Content="Trợ giúp" 
                            LargeGlyph="{dx:DXImage 'SvgImages/DiagramIcons/BindingEditorHelpIcon.svg'}"
                            ItemClick="Help_Click"
                            Hint="Hướng dẫn sử dụng (F1)"
                            RibbonStyle="Large"
                            KeyGesture="F1"
                            Margin="3"/>

                        <dxb:BarButtonItem 
                            Content="Về" 
                            Glyph="{dx:DXImage 'SvgImages/Outlook Inspired/About.svg'}"
                            ItemClick="About_Click"
                            Hint="Thông tin phần mềm"
                            RibbonStyle="Large"
                            Margin="3"/>
                    </dxr:RibbonPageGroup>

                </dxr:RibbonPage>
            </dxr:RibbonDefaultPageCategory>
        </dxr:RibbonControl>

        <!-- ========== TAB CONTROL ========== -->
        <dx:DXTabControl 
                            Grid.Row="1"
                            x:Name="mainTabControl"
                         Background="White"
                         SelectedIndex="0"
                         SelectionChanged="TabControl_SelectionChanged">

            <!-- ========== TAB 1: MẶT BẰNG & MẶT ĐỨNG ========== -->
            <dx:DXTabItem>
                <dx:DXTabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Images/PlanView.png" 
                           Width="16" Height="16" 
                           Margin="0,0,5,0"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                        <TextBlock Text="MẶT BẰNG &amp; MẶT ĐỨNG" VerticalAlignment="Center"/>
                    </StackPanel>
                </dx:DXTabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- ========== PANEL INPUT CHO MẶT BẰNG/MẶT ĐỨNG ========== -->
                    <Border Grid.Column="0" Background="WhiteSmoke" BorderBrush="#0078D4" BorderThickness="0,0,1,0" Padding="15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="THÔNG SỐ CỐNG HỘP" 
                                           FontWeight="Bold" 
                                           FontSize="15" 
                                           Margin="0,0,0,15" 
                                           Foreground="#0078D4"/>

                                <!-- Bản quá độ -->
                                <TextBlock Text="BẢN QUÁ ĐỘ" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="L1 (Dài):"/>
                                    <TextBox Grid.Column="1" x:Name="txtL1" Text="24500" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="W1 (Rộng):"/>
                                    <TextBox Grid.Column="1" x:Name="txtW1" Text="4000" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Separator/>

                                <!-- Sân cống & Tường đầu -->
                                <TextBlock Text="SÂN CỐNG - TƯỜNG ĐẦU" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="L2 (Sân cống):"/>
                                    <TextBox Grid.Column="1" x:Name="txtL2" Text="5000" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="W2 (Tường đầu):"/>
                                    <TextBox Grid.Column="1" x:Name="txtW2" Text="1800" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="W3 (Chân tường):"/>
                                    <TextBox Grid.Column="1" x:Name="txtW3" Text="2000" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Separator/>

                                <!-- Cống hộp -->
                                <TextBlock Text="CỐNG HỘP" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="W (Rộng):"/>
                                    <TextBox Grid.Column="1" x:Name="txtW" Text="5000" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="L3 (Dài):"/>
                                    <TextBox Grid.Column="1" x:Name="txtL3" Text="30000" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Separator/>

                                <!-- Tường cánh -->
                                <TextBlock Text="TƯỜNG CÁNH" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Alpha (Góc):"/>
                                    <TextBox Grid.Column="1" x:Name="txtAlpha" Text="20" TextChanged="OnDimensionChanged"/>
                                    <TextBlock Grid.Column="2" Text="°"/>
                                </Grid>

                                <Separator/>

                                <CheckBox x:Name="chkShowDimensions" Content="Hiển thị kích thước" Margin="5,8" IsChecked="True" Checked="OnDimensionChanged" Unchecked="OnDimensionChanged"/>
                                <CheckBox x:Name="chkShowPoints" Content="Hiển thị điểm" Margin="5,5" IsChecked="True" Checked="OnDimensionChanged" Unchecked="OnDimensionChanged"/>

                                <Button Content="RESET" Margin="0,18,0,0" Padding="12" Click="OnResetPlanElevation" Height="38"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- ========== CANVAS AREA - MẶT ĐỨNG + MẶT BẰNG ========== -->
                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- MẶT ĐỨNG (TRÊN) -->
                        <Border Grid.Row="0" Background="#F0F0F0" BorderBrush="#0078D4" BorderThickness="0,0,0,2" Padding="0">
                            <Grid>
                                <TextBlock Text="MẶT ĐỨNG" 
                                           FontWeight="Bold" 
                                           FontSize="14" 
                                           Foreground="#0078D4"
                                           HorizontalAlignment="Left"
                                           VerticalAlignment="Top"
                                           Margin="15,10"
                                           Panel.ZIndex="100"/>

                                <ScrollViewer x:Name="scrollViewerElevation" 
                                              HorizontalScrollBarVisibility="Hidden" 
                                              VerticalScrollBarVisibility="Hidden"
                                              Background="#F0F0F0">
                                    <Grid x:Name="zoomGridElevation" 
                                          Background="Transparent"
                                          MouseWheel="ZoomGridElevation_MouseWheel"
                                          MouseLeftButtonDown="ZoomGridElevation_MouseLeftButtonDown"
                                          MouseLeftButtonUp="ZoomGridElevation_MouseLeftButtonUp"
                                          MouseMove="ZoomGridElevation_MouseMove">
                                        <Grid.LayoutTransform>
                                            <ScaleTransform x:Name="scaleTransformElevation" ScaleX="1" ScaleY="1"/>
                                        </Grid.LayoutTransform>
                                        <Canvas x:Name="elevationCanvas" Width="1000" Height="400" Background="#F0F0F0"/>
                                    </Grid>
                                </ScrollViewer>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="15">
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomInElevation_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59555, ColorName=Blue}"
                                        GlyphHeight="20"/>
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomOutElevation_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59167, ColorName=Blue}"
                                        GlyphHeight="20"/>
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomResetElevation_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59180, ColorName=Blue}"
                                        GlyphHeight="16"/>
                                    <TextBlock x:Name="txtZoomLevelElevation" Text="100%" Foreground="#0078D4" FontWeight="Bold"
                                               VerticalAlignment="Center" Margin="8,0,0,0" FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- MẶT BẰNG (DƯỚI) -->
                        <Border Grid.Row="1" Background="WhiteSmoke" Padding="0">
                            <Grid>
                                <TextBlock Text="MẶT BẰNG" 
                                           FontWeight="Bold" 
                                           FontSize="14" 
                                           Foreground="#0078D4"
                                           HorizontalAlignment="Left"
                                           VerticalAlignment="Top"
                                           Margin="15,10"
                                           Panel.ZIndex="100"/>

                                <ScrollViewer x:Name="scrollViewerPlan" 
                                              HorizontalScrollBarVisibility="Hidden" 
                                              VerticalScrollBarVisibility="Hidden"
                                              Background="WhiteSmoke">
                                    <Grid x:Name="zoomGridPlan" 
                                          Background="Transparent"
                                          MouseWheel="ZoomGridPlan_MouseWheel"
                                          MouseLeftButtonDown="ZoomGridPlan_MouseLeftButtonDown"
                                          MouseLeftButtonUp="ZoomGridPlan_MouseLeftButtonUp"
                                          MouseMove="ZoomGridPlan_MouseMove">
                                        <Grid.LayoutTransform>
                                            <ScaleTransform x:Name="scaleTransformPlan" ScaleX="1" ScaleY="1"/>
                                        </Grid.LayoutTransform>
                                        <Canvas x:Name="planCanvas" Width="1000" Height="400" Background="WhiteSmoke"/>
                                    </Grid>
                                </ScrollViewer>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="15">
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomInPlan_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59555, ColorName=Blue}"
                                        GlyphHeight="20"/>
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomOutPlan_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59167, ColorName=Blue}"
                                        GlyphHeight="20"/>
                                    <dx:SimpleButton 
                                        Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                        Click="ZoomResetPlan_Click" Margin="3"
                                        Glyph="{dx:FontIconSource 59180, ColorName=Blue}"
                                        GlyphHeight="16"/>
                                    <TextBlock x:Name="txtZoomLevelPlan" Text="100%" Foreground="#0078D4" FontWeight="Bold"
                                               VerticalAlignment="Center" Margin="8,0,0,0" FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>
            </dx:DXTabItem>

            <!-- ========== TAB 2: MẶT CẮT & PHUI ĐÀO ========== -->
            <dx:DXTabItem>
                <dx:DXTabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Images/SectionView.png" 
                           Width="18" Height="18" 
                           Margin="0,0,5,0"
                           RenderOptions.BitmapScalingMode="HighQuality"/>
                        <TextBlock Text="MẶT CẮT &amp; PHUI ĐÀO" VerticalAlignment="Center"/>
                    </StackPanel>
                </dx:DXTabItem.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- ========== PANEL INPUT CHO MẶT CẮT ========== -->
                    <Border Grid.Column="0" Background="WhiteSmoke" BorderBrush="#0078D4" BorderThickness="0,0,1,0" Padding="15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="THÔNG SỐ MẶT CẮT" 
                                           FontWeight="Bold" 
                                           FontSize="15" 
                                           Margin="0,0,0,15" 
                                           Foreground="#0078D4"/>

                                <!-- Kích thước cống -->
                                <TextBlock Text="KÍCH THƯỚC CỐNG" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Rộng cống:"/>
                                    <TextBox Grid.Column="1" x:Name="txtSectionWidth" Text="5000" TextChanged="OnSectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Cao cống:"/>
                                    <TextBox Grid.Column="1" x:Name="txtSectionHeight" Text="3000" TextChanged="OnSectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Dày tường:"/>
                                    <TextBox Grid.Column="1" x:Name="txtWallThickness" Text="300" TextChanged="OnSectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Separator/>

                                <!-- Phui đào -->
                                <TextBlock Text="PHUI ĐÀO" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Độ sâu đào:"/>
                                    <TextBox Grid.Column="1" x:Name="txtExcavationDepth" Text="2000" TextChanged="OnSectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="mm"/>
                                </Grid>

                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="110"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="50"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Tỷ lệ phui:"/>
                                    <TextBox Grid.Column="1" x:Name="txtSlopeRatio" Text="1.5" TextChanged="OnSectionChanged"/>
                                    <TextBlock Grid.Column="2" Text="(1:n)"/>
                                </Grid>

                                <Separator/>

                                <CheckBox x:Name="chkShowSectionDimensions" Content="Hiển thị kích thước" Margin="5,8" IsChecked="True" Checked="OnSectionChanged" Unchecked="OnSectionChanged"/>
                                <CheckBox x:Name="chkShowExcavation" Content="Hiển thị phui đào" Margin="5,5" IsChecked="True" Checked="OnSectionChanged" Unchecked="OnSectionChanged"/>

                                <Button Content="RESET" Margin="0,18,0,0" Padding="12" Click="OnResetSection" Height="38"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- ========== CANVAS - MẶT CẮT ========== -->
                    <Grid Grid.Column="1">
                        <ScrollViewer x:Name="scrollViewerSection" 
                                      HorizontalScrollBarVisibility="Hidden" 
                                      VerticalScrollBarVisibility="Hidden"
                                      Background="#FAFAFA">
                            <Grid x:Name="zoomGridSection" 
                                  Background="Transparent"
                                  MouseWheel="ZoomGridSection_MouseWheel"
                                  MouseLeftButtonDown="ZoomGridSection_MouseLeftButtonDown"
                                  MouseLeftButtonUp="ZoomGridSection_MouseLeftButtonUp"
                                  MouseMove="ZoomGridSection_MouseMove">
                                <Grid.LayoutTransform>
                                    <ScaleTransform x:Name="scaleTransformSection" ScaleX="1" ScaleY="1"/>
                                </Grid.LayoutTransform>
                                <Canvas x:Name="sectionCanvas" Width="1000" Height="800" Background="#FAFAFA"/>
                            </Grid>
                        </ScrollViewer>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="15">
                            <dx:SimpleButton 
                                Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                Click="ZoomInSection_Click" Margin="3"
                                Glyph="{dx:FontIconSource 59555, ColorName=Blue}"
                                GlyphHeight="20"/>
                            <dx:SimpleButton 
                                Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                Click="ZoomOutSection_Click" Margin="3"
                                Glyph="{dx:FontIconSource 59167, ColorName=Blue}"
                                GlyphHeight="20"/>
                            <dx:SimpleButton 
                                Width="36" Height="36" CornerRadius="5" BorderBrush="#0078D4"
                                Click="ZoomResetSection_Click" Margin="3"
                                Glyph="{dx:FontIconSource 59180, ColorName=Blue}"
                                GlyphHeight="16"/>
                            <TextBlock x:Name="txtZoomLevelSection" Text="100%" Foreground="#0078D4" FontWeight="Bold"
                                       VerticalAlignment="Center" Margin="8,0,0,0" FontSize="12"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </dx:DXTabItem>
            
            <!-- ========== TAB 3: 3D VIEW ========== -->
            <dx:DXTabItem>
                <dx:DXTabItem.Header>
                    <StackPanel Orientation="Horizontal">
                        <Image Source="/Images/3DView.png" 
                   Width="16" Height="16" 
                   Margin="0,0,5,0"/>
                        <TextBlock Text="MÔ HÌNH 3D" VerticalAlignment="Center"/>
                    </StackPanel>
                </dx:DXTabItem.Header>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- ========== PANEL CONTROLS 3D ========== -->
                    <Border Grid.Column="0" Background="WhiteSmoke" BorderBrush="#0078D4" BorderThickness="0,0,1,0" Padding="15">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock Text="ĐIỀU KHIỂN 3D" 
                               FontWeight="Bold" 
                               FontSize="15" 
                               Margin="0,0,0,15" 
                               Foreground="#0078D4"/>

                                <!-- Camera Presets -->
                                <TextBlock Text="CAMERA" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Button Content="Front View" Click="CameraFront_Click" Margin="0,5" Height="32"/>
                                <Button Content="Back View" Click="CameraBack_Click" Margin="0,5" Height="32"/>
                                <Button Content="Top View" Click="CameraTop_Click" Margin="0,5" Height="32"/>
                                <Button Content="Bottom View" Click="CameraBottom_Click" Margin="0,5" Height="32"/>
                                <Button Content="Left View" Click="CameraLeft_Click" Margin="0,5" Height="32"/>
                                <Button Content="Right View" Click="CameraRight_Click" Margin="0,5" Height="32"/>

                                <Separator/>

                                <!-- Display Options -->
                                <TextBlock Text="HIỂN THỊ" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <CheckBox x:Name="chkShowWireframe" Content="Wireframe" Margin="5,8" IsChecked="False" Checked="OnDisplayChanged" Unchecked="OnDisplayChanged"/>
                                <CheckBox x:Name="chkShowBoundingBox" Content="Bounding Box" Margin="5,5" IsChecked="False" Checked="OnDisplayChanged" Unchecked="OnDisplayChanged"/>
                                <CheckBox x:Name="chkShowNormals" Content="Show Normals" Margin="5,5" IsChecked="False" Checked="OnDisplayChanged" Unchecked="OnDisplayChanged"/>

                                <Separator/>

                                <!-- Materials -->
                                <TextBlock Text="VẬT LIỆU" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <ComboBox x:Name="cmbMaterial" SelectionChanged="OnMaterialChanged" Margin="5" Height="32">
                                    <ComboBoxItem Content="Concrete (Bê tông)" IsSelected="True"/>
                                    <ComboBoxItem Content="Steel (Thép)"/>
                                    <ComboBoxItem Content="Plastic (Nhựa)"/>
                                    <ComboBoxItem Content="Glass (Kính)"/>
                                    <ComboBoxItem Content="Wood (Gỗ)"/>
                                </ComboBox>

                                <Separator/>

                                <!-- Export -->
                                <TextBlock Text="XUẤT" FontWeight="SemiBold" Margin="0,10,0,8" Foreground="#0078D4" FontSize="12"/>

                                <Button Content="Export OBJ" Click="ExportOBJ_Click" Margin="0,5" Height="32"/>
                                <Button Content="Export STL" Click="ExportSTL_Click" Margin="0,5" Height="32"/>
                                <Button Content="Export Screenshot" Click="ExportScreenshot_Click" Margin="0,5" Height="32"/>

                                <Separator/>

                                <Button Content="RESET 3D" Margin="0,18,0,0" Padding="12" Click="OnReset3D" Height="38"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <!-- ========== HELIX 3D VIEWPORT ========== -->
                    <helix:HelixViewport3D x:Name="helixViewport" 
                               Grid.Column="1"
                               Background="#1E1E1E"
                               ShowViewCube="True"
                               ShowCoordinateSystem="True"
                               ShowFrameRate="False"
                               ShowCameraInfo="False"
                               ViewCubeTopText="TOP"
                               ViewCubeFrontText="FRONT"
                               ViewCubeRightText="RIGHT"
                               ViewCubeBackText="BACK"
                               ViewCubeLeftText="LEFT"
                               ViewCubeBottomText="BOTTOM"
                               ViewCubeOpacity="0.8"
                               ZoomExtentsWhenLoaded="True"
                               CameraRotationMode="Turntable"
                               InfiniteSpin="False"
                               ModelUpDirection="0,1,0">

                        <!-- Default Camera -->
                        <helix:HelixViewport3D.Camera>
                            <PerspectiveCamera Position="15,10,15" 
                                   LookDirection="-15,-10,-15" 
                                   UpDirection="0,1,0" 
                                   FieldOfView="60"/>
                        </helix:HelixViewport3D.Camera>

                        <!-- Lights -->
                        <helix:DefaultLights/>

                        <!-- Grid Floor -->
                        <helix:GridLinesVisual3D x:Name="gridLines"
                                     Width="50"
                                     Length="50"
                                     MinorDistance="1"
                                     MajorDistance="5"
                                     Thickness="0.01"
                                     Fill="#40FFFFFF"
                                     Normal="0,1,0"/>

                        <!-- Coordinate System Axes -->
                        <helix:CoordinateSystemVisual3D x:Name="coordSystem" 
                                            ArrowLengths="3"/>

                        <!-- 3D Model Container -->
                        <ModelVisual3D x:Name="modelVisual3D"/>

                    </helix:HelixViewport3D>

                    <!-- Overlay Info -->
                    <StackPanel Grid.Column="1"
                    VerticalAlignment="Top" 
                    HorizontalAlignment="Left" 
                    Margin="15" 
                    Background="#AA000000">
                        <TextBlock x:Name="txt3DInfo" Text="3D View - Helix Toolkit" Foreground="White" FontSize="14" FontWeight="Bold"/>
                        <TextBlock x:Name="txt3DStats" Text="Ready" Foreground="#AAAAAA" FontSize="10" Margin="0,5,0,0"/>
                    </StackPanel>
                </Grid>
            </dx:DXTabItem>
        </dx:DXTabControl>
    </Grid>
</Window>